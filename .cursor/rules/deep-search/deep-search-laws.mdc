---
description: Laws enforced during /deep-search runs (single source of truth)
globs: ".cursor/commands/deep-search/**,.cursor/deep-search/**,.cursor/plans/deep-search.*.md"
alwaysApply: false
---

# Deep-Search Laws (Workflow + Proof Gates)

## Shared references (passive context)
- `@.cursor/rules/shared/workflow-primitives.mdc`
- `@.cursor/rules/shared/proof-discipline.mdc`
- `@.cursor/rules/shared/octocode-mandate.mdc`
- `@.cursor/rules/shared/mcp-s-mandate.mdc`

## Workflow Gates
- **Clarify-first:** do not start research until the Search Spec is unambiguous (feature + intent + breadcrumbs + required consumers/boundaries).
- **Plan-first:** write a short plan to `.cursor/plans/deep-search.<feature>.md` before deep execution.
- **Draft-first:** `/deep-search.report` writes **DRAFT only** (file-only).
- **Never publish before validation:** `/deep-search.publish` requires a passing `/deep-search.verify`.

## Deep-search specifics (artifacts + logging)
- Search spec: `.cursor/deep-search/<feature>/SEARCH-SPEC.md`
- Evidence artifacts:
  - `.cursor/deep-search/<feature>/trace-ledger.md`
  - `.cursor/deep-search/<feature>/octocode-queries.md`
  - `.cursor/deep-search/<feature>/mcp-s-notes.md`
- Unlimited iteration: repeat MCP-S + Octocode until everything is resolved or **NOT FOUND** (with searches + scope).

## Output Requirements
- **Dual output:** FINAL report must be printed in chat **and** written to `ARCHITECTURE-REPORT.md`.
- **MCP-S notes required:** `mcp-s-notes.md` must exist and contain at least one query per major topic.
- **DevEx ownership required:** if ownership is mentioned, must have DevEx `code_owners_for_path` query.

## SDK Generation Chain (MANDATORY when SDK mentioned)
- IDL source → generator trigger/config → generated `/rpc` + `/types` → runtime transport boundary (+ auth/baseUrl/retries).
