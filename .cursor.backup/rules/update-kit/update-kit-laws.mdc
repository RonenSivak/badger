---
description: Laws enforced during /update-kit runs
globs: ".cursor/commands/update-kit/**, .cursor/update-kit/**"
alwaysApply: false
---

# Update-Kit Laws

## Shared structure (2026)
Badger kits may reuse shared passive context:
- `.cursor/rules/shared/` (mandates + proof discipline + workflow primitives)
- `.cursor/guides/` (how-to knowledge)

## Workflow Gates

1. **Clarify before analyze**: UPDATE-SPEC must exist before analyzing.
2. **Analyze before plan**: ANALYSIS.md must exist before creating plan.
3. **Plan before execute**: UPDATE-PLAN.md must exist before making changes.
4. **Backup before modify**: Always backup files before MODIFY/DELETE actions.
5. **Verify before publish**: VERIFY-RESULT must show PASS before publishing.
6. **No publish on FAIL**: Hard-fail if verification not passed.

## Safety Rules

7. **Kit must exist**: Cannot update a non-existent kit. Suggest `/create-kit` instead.
8. **Preserve content**: When modifying, preserve existing content unless explicitly fixing it.
9. **Atomic changes**: Complete each action fully before moving to next.
10. **Fail fast on P0**: If a critical action fails, STOP and report.

## Backup Rules

11. **Backup location**: `.cursor/update-kit/<kit>/backup/`
12. **Preserve structure**: Backup maintains relative path structure.
13. **Backup before delete**: Never delete without backup.

## Reference Integrity

14. **No orphan references**: All delegates/rules/skills must exist after update.
15. **Update both ends**: When adding a file, update references to it.
16. **Check before delete**: Verify no references before removing a file.

## Frontmatter Rules

17. **All files need frontmatter**: Every .md/.mdc must have description, globs, alwaysApply.
18. **Meaningful descriptions**: Descriptions should explain purpose, not repeat filename.
19. **Consistent format**: Follow existing frontmatter patterns in the kit.
